<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2012. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<!--
  This is the Ant build file for the IEG validation.
  Validates IEG scripts in all application components.  -->

<project name="IEGValidator" default="validatealliegscripts">

  <!--  ***************************  -->
  <!--  ***  Import Properties  ***  -->
  <!--  ***************************  -->
  <import file="./app_properties.xml" />

  <!--  **************************  -->
  <!--  ***  Import Utilities  ***  -->
  <!--  **************************  -->
  <import file="./app_utilities.xml" />

  <!--  **************************  -->
  <!--  ***  Setup Class Path  ***  -->
  <!--  **************************  -->
  <path id="validator.classpath">
    <path refid="j.cp"/>
    <pathelement path="${client.dir}/build/uim"/>
  </path>

  <taskdef name="antapply" classname="curam.util.tools.AntApply"
    classpathref="validator.classpath" />


    <!--  ************************************  -->
    <!--  ***     Validate IEG Scripts     ***  -->
    <!--  ************************************  -->
    <target name="validatealliegscripts"
      description="validate IEG.">

      <antcall target="dispmsg" inheritAll="false">
        <param name="prm.msg" value="Start validating the IEG scripts."/>
      </antcall>

      <antcall target="validateallscriptsfordeprecationwarnings">
        <param name="scripts.pattern"  value="*.xml" />
      </antcall>

      <antcall target="dispmsg" inheritAll="false">
        <param name="prm.msg" value="End validating the IEG."/>
      </antcall>
    </target>

    <!--  ****************************************************************  -->
    <!--  ***      Validate IEG Scripts for Deprecation warnings       ***  -->
    <!--  ****************************************************************  -->

    <taskdef name="antapply" classname="curam.util.tools.AntApply"
        classpathref="validator.classpath" />

    <target name="validateallscriptsfordeprecationwarnings"
      description="validate all the scripts for deprecation warnings.">

      <antapply type="both"
        executable="${JAVA_HOME}/bin/java"
        failonerror="false"
        resultproperty="final.result">

        <!-- Java Arguments -->
        <arg value="-Xmx${java.maxmemory}" />
        <arg value="-classpath" />
        <arg pathref="validator.classpath" />
        <arg line="-Xbootclasspath/p:${jars.allxml}" />

        <!-- Application System Properties -->
        <arg line="-Dcuram.disable.dynamic.properties=true"/>
        <arg line="-Dcuram.project.name=curam"/>

        <!-- The Validation Java Class -->
        <arg line="curam.ieg.validation.impl.CommandLineScriptValidator" />

        <!-- The rule set file Argument -->
        <arg line="-script.file" /><srcfile />

        <!-- The rule set files to be validated -->
        <fileset dir="${SERVER_DIR}/components">
          <patternset>
            <include name="*/ieg/${scripts.pattern}"/>
          </patternset>
        </fileset>

      </antapply>

      <fail message="Validation failed.">
       <condition>
         <equals arg1="${final.result}" arg2="1" />
       </condition>
     </fail>
    </target>


</project>
