<?xml version="1.0" encoding="UTF-8"?>
<Class xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:noNamespaceSchemaLocation="file:/D:/Curam/catalog/RuleSet.xsd"
 extends="SAHouseholdIncomeCategory" extendsRuleSet="SocialAssistanceDisplayRuleSet"
 name="SeniorCitizenHouseholdIncomeCategory">
  <!-- 
    The eligibility rule object for the case.    
    At program recommendation level, this attribute will be specified. 
  -->
  <Attribute name="productCase">
    <type>
      <ruleclass name="SeniorCitizenProductCase" ruleset="SeniorCitizenEligibilityAndEntitlementRuleSet"/>
    </type>
    <derivation>
      <create
        ruleclass="SeniorCitizenProductCase"
        ruleset="SeniorCitizenEligibilityAndEntitlementRuleSet"
        >
        <specify attribute="productDeliveryCase">
          <reference attribute="productDeliveryCase"/>
        </specify>
      </create>
    </derivation>
  </Attribute>
  <Attribute name="primaryClientCPRRecord">
    <type>
      <ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/>
    </type>
    <derivation>
      <reference attribute="primaryClientCPRRecord">
        <reference attribute="productCase"/>
      </reference>
    </derivation>
  </Attribute>
  <Attribute name="eligibilityUnitMembers">
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="List">
          <ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/>
        </javaclass>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <filter>
          <list>
            <dynamiclist>
              <list>
                <intervalvalue>
                  <reference attribute="eligibleMembersTimeline">
                    <reference attribute="eligibilityUnit">
                      <reference attribute="productCase"/>
                    </reference>
                  </reference>
                </intervalvalue>
              </list>
              <listitemexpression>
                <reference attribute="caseParticipantRoleRecord">
                  <current/>
                </reference>
              </listitemexpression>
            </dynamiclist>
          </list>
          <listitemexpression>
            <not>
              <equals>
                <null/>
                <current/>
              </equals>
            </not>
          </listitemexpression>
        </filter>
        
      </timelineoperation>
    </derivation>
  </Attribute>

<Attribute name="isSingleMemberAndNotSatisfyingAgeLimit">
  <type>
    <javaclass name="curam.creole.value.Timeline">
      <javaclass name="Boolean"/>
    </javaclass>
  </type>
  <derivation>
    <timelineoperation>
      <choose>
        <type>
          <javaclass name="Boolean"/>
        </type>
        <when>
          <condition>
            <all>
              <fixedlist>
                <listof>
                  <javaclass name="Boolean"/>
                </listof>
                <members>
                  <equals>
                    <property name="size">
                      <object>
                        <intervalvalue>
                          <reference attribute="eligibilityUnitMembers"/>
                        </intervalvalue>
                      </object>
                    </property>
                    <Number value="1"/>
                  </equals>
                  <any>
                    <dynamiclist>
                      <list>
                        <intervalvalue>
                          <reference attribute="eligibilityUnitMembers"/>
                        </intervalvalue>
                      </list>
                      <listitemexpression>
                        <not>
                          <intervalvalue>
                            <reference attribute="isAgeAboveSixtyTimeline">
                              <create ruleclass="SeniorCitizenCPRCalculator"
                                ruleset="SeniorCitizenEligibilityAndEntitlementRuleSet">
                                <current/>
                              </create>
                            </reference>
                          </intervalvalue>
                        </not>
                      </listitemexpression>
                    </dynamiclist>
                  </any>
                  
                </members>
              </fixedlist>
            </all>
          </condition>
          <value>
            <true/>
          </value>
        </when>
        <otherwise>
          <value>
            <false/>
          </value>
        </otherwise>
      </choose>
    </timelineoperation>
  </derivation>
</Attribute>
  
  <Attribute name="totalGrossBenefitAmount">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <choose>
          <type>
            <javaclass name="Number"/>
          </type>
          <when>
            <condition>
              <intervalvalue>
                <reference attribute="isSingleMemberAndNotSatisfyingAgeLimit"/>
              </intervalvalue>
            </condition>
            <value>
              <Number value="0"/>
            </value>
          </when>
          <otherwise>
            <value>
              <sum>
                <intervalvalue>
                  <reference attribute="amountList"/>
                </intervalvalue>
              </sum>
            </value>
          </otherwise>
        </choose>
      </timelineoperation>
    </derivation>
  </Attribute>
  
  <Attribute name="totalIncomeTimeline">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <choose>
          <type>
            <javaclass name="Number"/>
          </type>
          <when>
            <condition>
              <intervalvalue>
                <reference attribute="isSingleMemberAndNotSatisfyingAgeLimit"/>
              </intervalvalue>
            </condition>
            <value>
              <Number value="0"/>
            </value>
          </when>
          <otherwise>
            <value>
              <intervalvalue>
                <reference attribute="unearnedIncomeAmount">
                  <intervalvalue>
                    <reference attribute="seniorCitizenEligibilityUnitCalculator">
                      <reference attribute="seniorCitizenProgramCalculator">
                        <reference attribute="productCase"/>
                      </reference>
                    </reference>
                  </intervalvalue>
                </reference>
              </intervalvalue>
            </value>
          </otherwise>
        </choose>
      </timelineoperation>
    </derivation>
  </Attribute>

  <Attribute name="totalExpenseAmountTimeline">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <choose>
          <type>
            <javaclass name="Number"/>
          </type>
          <when>
            <condition>
              <intervalvalue>
                <reference attribute="isSingleMemberAndNotSatisfyingAgeLimit"/>
              </intervalvalue>
            </condition>
            <value>
              <Number value="0"/>
            </value>
          </when>
          <otherwise>
            <value>
              <intervalvalue>
                <reference attribute="totalExpenseAmountTimeline">
                  <intervalvalue>
                    <reference attribute="seniorCitizenEligibilityUnitCalculator">
                      <reference attribute="seniorCitizenProgramCalculator">
                        <reference attribute="productCase"/>
                      </reference>
                    </reference>
                  </intervalvalue>
                </reference>
              </intervalvalue>
            </value>
          </otherwise>
        </choose>
      </timelineoperation>
    </derivation>
  </Attribute>
  <Attribute name="totalCountableIncomeTimeline">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <choose>
          <type>
            <javaclass name="Number"/>
          </type>
          <when>
            <condition>
              <intervalvalue>
                <reference attribute="isSingleMemberAndNotSatisfyingAgeLimit"/>
              </intervalvalue>
            </condition>
            <value>
              <Number value="0"/>
            </value>
          </when>
          <otherwise>
            <value>
              <intervalvalue>
                <reference attribute="totalCountableIncomeTimeline">
                  <intervalvalue>
                    <reference attribute="seniorCitizenEligibilityUnitCalculator">
                      <reference attribute="seniorCitizenProgramCalculator">
                        <reference attribute="productCase"/>
                      </reference>
                    </reference>
                  </intervalvalue>
                </reference>
              </intervalvalue>
            </value>
          </otherwise>
        </choose>
      </timelineoperation>
    </derivation>
  </Attribute>
  
  <Attribute name="monthlyAmountTimeline">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <choose>
          <type>
            <javaclass name="Number"/>
          </type>
          <when>
            <condition>
              <intervalvalue>
                <reference attribute="isSingleMemberAndNotSatisfyingAgeLimit"/>
              </intervalvalue>
            </condition>
            <value>
              <Number value="0"/>
            </value>
          </when>
          <otherwise>
            <value>
              <intervalvalue>
                <reference attribute="monthlyAmountTimeline">
                  <intervalvalue>
                    <reference attribute="seniorCitizenEligibilityUnitCalculator">
                      <reference attribute="seniorCitizenProgramCalculator">
                        <reference attribute="productCase"/>
                      </reference>
                    </reference>
                  </intervalvalue>
                </reference>
              </intervalvalue>
            </value>
          </otherwise>
        </choose>
      </timelineoperation>
    </derivation>
  </Attribute>
 <Attribute name="amountList">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="List">
          <javaclass name="Number"/>
        </javaclass>
      </javaclass>
    </type>
    <derivation>
        <timelineoperation>
          <choose>
            <type>
              <javaclass name="List">
                <javaclass name="Number"/>
              </javaclass>
            </type>
            <when>
              <condition>
                <intervalvalue>
                  <reference attribute="isSingleMemberAndNotSatisfyingAgeLimit"/>
                </intervalvalue>
              </condition>
              <value>
                <fixedlist>
                  <listof>
                    <javaclass name="Number"/>
                  </listof>
                  <members>
                    <Number value="0"/>
                  </members>
                </fixedlist>
              </value>
            </when>
            <otherwise>
              <value>
                <filter>
                  <list>
                    <intervalvalue>
                      <reference attribute="amountList">
                        <create ruleclass="AmountCalculator"  ruleset="SeniorCitizenEligibilityAndEntitlementRuleSet">
                          <reference attribute="eligibilityUnitMembers" />
                        </create>
                      </reference>
                    </intervalvalue>
                  </list>
                  <listitemexpression>
                    <not>
                      <equals>
                        <null/>
                        <current/>
                      </equals>
                    </not>
                  </listitemexpression>
                </filter>
              </value>
            </otherwise>
          </choose>
        </timelineoperation>
    </derivation>
  </Attribute>

</Class>
