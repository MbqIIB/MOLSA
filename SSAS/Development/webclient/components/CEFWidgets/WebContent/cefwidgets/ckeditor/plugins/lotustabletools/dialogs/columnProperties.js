/*
Copyright IBM Corp. 2010-2013  All Rights Reserved.
*/

CKEDITOR.dialog.add('columnProperties',function(a){var b,c,d,e,f,g=function(){var j=a.getSelection(),k=j.getSelectedElement(),l;if(k&&(k.getName()=='td'||k.getName()=='th'))l=k;else{var m=j.getCommonAncestor();if(m&&m instanceof CKEDITOR.dom.element&&(m.getName()=='td'||m.getName()=='th'))l=m;else l=m.getAscendant('td')?m.getAscendant('td'):m.getAscendant('th');}if(!l)return;e=l.getAscendant('tr');var n=e.getChildCount();b=-1;c=0;var o;for(var p=0;p<n;p++){o=e.getChild(p);c+=o.getAttribute('colspan')?parseInt(o.getAttribute('colspan'),10):1;if(l.equals(e.getChild(p))){b=p;break;}}d=l.getAttribute('colspan')?parseInt(l.getAttribute('colspan'),10):1;},h=function(j){var k=0,l=-1;for(var m=0;m<j.getChildCount();m++){currentCell=j.getChild(m);currentColspan=currentCell.getAttribute('colspan')?parseInt(currentCell.getAttribute('colspan'),10):1;k+=currentColspan;if(k==c){if(currentColspan==d){l=m;break;}else{l=-1;break;}}else if(k>c){l=-1;break;}}return l;},i=function(){f=[];if(b!=-1){var j=e.getAscendant('table'),k,l,m;for(var n=0;n<j.getChildCount();n++){k=j.getChild(n);if(k.getName()=='thead'||k.getName()=='tbody')for(var o=0;o<k.getChildCount();o++){l=k.getChild(o);m=h(l);if(m!=-1)f.push(l.getChild(m));}}}return f;};return{title:a.lang.ibm.table.columnTitle,minWidth:220,minHeight:50,onShow:function(){g();var j,k,l,m=false,n=/^(\d+(?:\.\d+)?)(px|%|in|cm|mm|em|ex|pt|pc)$/,o=/^(\d+(?:\.\d+)?)$/;i();if(f.length>0)l=f[0].getStyle('width')?f[0].getStyle('width'):f[0].getAttribute('width');if(l==undefined)m=true;else{var p=o.exec(l);if(p)l+='px';for(var q=1;q<f.length;q++){j=f[q].getStyle('width')?f[q].getStyle('width'):f[q].getAttribute('width');p=o.exec(j);if(p)j+='px';if(j!=l){m=true;break;}}}if(!m&&l){k=n.exec(l);if(k)this.setupContent(k);}},onOk:function(){for(var j=0;j<f.length;j++)this.commitContent(f[j]);},contents:[{id:'info',style:'width: 100%',elements:[{type:'hbox',children:[{label:a.lang.common.width,type:'text',id:'colWidth',setup:function(j){if(j&&j[1])this.setValue(j[1]);},commit:function(j){var k=parseFloat(this.getValue(),10),l=this.getDialog().getValueOf('info','widthType');if(!isNaN(k))j.setStyle('width',k+l);else j.removeStyle('width');j.removeAttribute('width');},validate:CKEDITOR.dialog.validate.number(a.lang.ibm.table.invalidColumnWidth)},{type:'select',id:'widthType',label:a.lang.table.widthUnit,'default':'px',items:[[a.lang.table.widthPx,'px'],[a.lang.table.widthPc,'%'],[a.lang.ibm.common.widthIn,'in'],[a.lang.ibm.common.widthCm,'cm'],[a.lang.ibm.common.widthMm,'mm'],[a.lang.ibm.common.widthEm,'em'],[a.lang.ibm.common.widthEx,'ex'],[a.lang.ibm.common.widthPt,'pt'],[a.lang.ibm.common.widthPc,'pc']],setup:function(j){if(j&&j[2])this.setValue(j[2]);
}}]}]}]};});
