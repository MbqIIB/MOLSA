<?xml version="1.0" encoding="UTF-8"?>
<Class xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../../../../../../../../../../Curam/catalog/RuleSet.xsd"
  extends="DefaultProgramRecommendationDisplayCase"
  extendsRuleSet="DefaultProgramRecommendationDisplayRuleSet" name="SAHouseholdIncomeCategory">
  <!-- 
    The eligibility rule object for the case.    
    At program recommendation level, this attribute will be specified. 
    
  -->

  <Attribute name="coverageTypeHouseholdIncomeCategory">
    <type>
      <ruleclass name="SAHouseholdIncomeCategory" ruleset="SocialAssistanceDisplayRuleSet"/>
    </type>
    <derivation>
      <specified/>
    </derivation>
  </Attribute>

  <Attribute name="productCase">
    <type>
      <ruleclass name="SocialAssistanceProductCase" ruleset="SocialAssistanceRuleSet"/>
    </type>
    <derivation>
      <reference attribute="productCase">
        <reference attribute="coverageTypeHouseholdIncomeCategory"/>
      </reference>
    </derivation>
  </Attribute>
  
  <Attribute name="primaryClientCPRRecord">
    <type>
      <ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/>
    </type>
    <derivation>
      <reference attribute="primaryClientCPRRecord">
        <reference attribute="coverageTypeHouseholdIncomeCategory"/>
      </reference>
    </derivation>
  </Attribute>
  <Attribute name="eligibilityUnitMembers">
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="List">
          <ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/>
        </javaclass>
      </javaclass>
    </type>
    <derivation>
      <reference attribute="eligibilityUnitMembers">
        <reference attribute="coverageTypeHouseholdIncomeCategory"/>
      </reference>
    </derivation>
  </Attribute>

  <Attribute name="householdMembersCPRRecords">
    <Annotations>
      <Display/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="List">
          <ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/>
        </javaclass>
      </javaclass>
    </type>
    <derivation>
      <reference attribute="eligibilityUnitMembers"/>
    </derivation>
  </Attribute>

  <Attribute name="cprIDsWithoutDuplicate">
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="List">
          <javaclass name="Number"/>
        </javaclass>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <removeduplicates>
          <dynamiclist>
            <list>
              <intervalvalue>
                <reference attribute="householdMembersCPRRecords"/>
              </intervalvalue>
            </list>
            <listitemexpression>
              <reference attribute="caseParticipantRoleID">
                <current/>
              </reference>
            </listitemexpression>
          </dynamiclist>
        </removeduplicates>
      </timelineoperation>

    </derivation>
  </Attribute>
  <Attribute name="householdMembersList">
    <Annotations>
      <Display/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="List">
          <javaclass name="String"/>
        </javaclass>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <dynamiclist>
          <list alias="outer">
            <intervalvalue>
              <reference attribute="cprIDsWithoutDuplicate"/>
            </intervalvalue>
          </list>
          <listitemexpression>
            <reference attribute="concernRoleName">
              <reference attribute="participantRole">
                <singleitem onEmpty="returnNull" onMultiple="returnFirst">
                  <filter>
                    <list alias="inner">
                      <intervalvalue>
                        <reference attribute="householdMembersCPRRecords"/>
                      </intervalvalue>
                    </list>
                    <listitemexpression>
                      <equals>
                        <current alias="outer"/>
                        <reference attribute="caseParticipantRoleID">
                          <current alias="inner"/>
                        </reference>
                      </equals>
                    </listitemexpression>
                  </filter>
                </singleitem>
              </reference>
            </reference>
          </listitemexpression>
        </dynamiclist>
      </timelineoperation>
    </derivation>
  </Attribute>
  <Attribute name="amountList">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="List">
          <javaclass name="Number"/>
        </javaclass>
      </javaclass>
    </type>
    <derivation>
      <reference attribute="amountList">
        <reference attribute="coverageTypeHouseholdIncomeCategory"/>
      </reference>
    </derivation>
  </Attribute>
  <Attribute name="totalGrossBenefitAmount">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <sum>
          <intervalvalue>
            <reference attribute="amountList"/>
          </intervalvalue>
        </sum>
      </timelineoperation>
    </derivation>
  </Attribute>

  <Attribute name="totalIncomeTimeline">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <reference attribute="totalIncomeTimeline">
        <reference attribute="coverageTypeHouseholdIncomeCategory"/>
      </reference>
    </derivation>
  </Attribute>

  <Attribute name="totalExpenseAmountTimeline">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <reference attribute="totalExpenseAmountTimeline">
        <reference attribute="coverageTypeHouseholdIncomeCategory"/>
      </reference>
    </derivation>
  </Attribute>
  <Attribute name="totalCountableIncomeTimeline">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <reference attribute="totalCountableIncomeTimeline">
        <reference attribute="coverageTypeHouseholdIncomeCategory"/>
      </reference>
    </derivation>
  </Attribute>

  <Attribute name="monthlyAmountTimeline">
    <Annotations>
      <Display domain="CURAM_AMOUNT"/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Number"/>
      </javaclass>
    </type>
    <derivation>
      <reference attribute="monthlyAmountTimeline">
        <reference attribute="coverageTypeHouseholdIncomeCategory"/>
      </reference>
    </derivation>
  </Attribute>
  
  <Attribute name="householdMembers">
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="List">
          <ruleclass name="SAHouseholdUnitMember" ruleset="SocialAssistanceRuleSet"/>
        </javaclass>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
          <filter>
            <list>
              <intervalvalue>
                <reference attribute="eligibleMembersTimeline">
                  <reference attribute="eligibilityUnit"> 
                  <reference attribute="productCase"/>
                  </reference>
                </reference>
              </intervalvalue>
            </list>
            <listitemexpression>
              <not>
                <equals>
                  <null/>
                  <reference attribute="caseParticipantRoleRecord">
                    <current/>
                  </reference>
                </equals>
              </not>
            </listitemexpression>
          </filter>
      </timelineoperation>
    </derivation>
  </Attribute>
  
  <Attribute name="isInEligibleMember">
    <Annotations>
      <Display/>
    </Annotations>
    <type>
      <javaclass name="curam.creole.value.Timeline">
        <javaclass name="Boolean"/>
      </javaclass>
    </type>
    <derivation>
      <timelineoperation>
        <all>
          <dynamiclist>
            <list>
              <intervalvalue>
                <reference attribute="householdMembers"/>
              </intervalvalue>
            </list>
            <listitemexpression>
              <choose>
                <type>
                  <javaclass name="Boolean"/>
                </type>
                <when>
                  <condition>
                    <equals>
                      <intervalvalue>
                        <reference attribute="filterTypeTimeline">
                            <current/>
                        </reference>
                      </intervalvalue>
                      <String value="InEligibleMember"/>
                    </equals>
                  </condition>
                  <value>
                    <true/>
                  </value>
                </when>
                <otherwise>
                  <value>
                    <false/>
                  </value>
                </otherwise>
              </choose>
            </listitemexpression>
          </dynamiclist>
        </all>
      </timelineoperation>
    </derivation>
  </Attribute>
</Class>
