<?xml version="1.0" encoding="UTF-8"?>
<RuleSet xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="file:/D:/Curam/catalog/RuleSet.xsd"
  name="MolsaRelationshipValidationRuleSet">
  <Class extends="DefaultEvidenceValidationResult" extendsRuleSet="EvidenceValidationRuleSet"
    name="MolsaRelationshipValidationResult">
    <Attribute name="evidence">
      <type>
        <ruleclass name="MolsaRelationship" ruleset="MolsaRelationshipRuleSet"/>
      </type>
      <derivation>
        <specified/>
      </derivation>
    </Attribute>
    <Attribute name="description">
      <type>
        <javaclass name="curam.creole.value.Message"/>
      </type>
      <derivation>
        <ResourceMessage key="MolsaRelationshipValidationResult.description"
          resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet">
          <reference attribute="concernRoleName">
            <reference attribute="concernRoleRecord"/>
          </reference>
        </ResourceMessage>
      </derivation>
    </Attribute>
    <Attribute name="standardValidations">
      <type>
        <javaclass name="List">
          <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <fixedlist>
          <listof>
            <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
          </listof>
          <members>
            <reference attribute="fromDateAfterDOBValidation"/>
            <reference attribute="toDateBeforeDODValidation"/>
            <reference attribute="relativeDuplicateClientValidation"/>
            <reference attribute="duplicateRelationshipValidation"/>
          </members>
        </fixedlist>
      </derivation>
    </Attribute>
    <Attribute name="detailsValidations">
      <type>
        <javaclass name="java.util.List">
          <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <null/>
      </derivation>
    </Attribute>
    <Attribute name="preCreateValidations">
      <type>
        <javaclass name="java.util.List">
          <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <null/>
      </derivation>
    </Attribute>
    <Attribute name="preModifyValidations">
      <type>
        <javaclass name="List">
          <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <fixedlist>
          <listof>
            <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
          </listof>
          <members>
            <reference attribute="validateTypeChanged"/>
          </members>
        </fixedlist>
      </derivation>
    </Attribute>
    <Attribute name="postCreateValidations">
      <type>
        <javaclass name="List">
          <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <fixedlist>
          <listof>
            <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
          </listof>
          <members>
            <reference attribute="createDuplicateClientValidation"/>
          </members>
        </fixedlist>
      </derivation>
    </Attribute>
    <Attribute name="postModifyValidations">
      <type>
        <javaclass name="List">
          <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <fixedlist>
          <listof>
            <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
          </listof>
          <members>
            <reference attribute="modifyDuplicateClientValidation"/>
            <reference attribute="effectiveDateAfterDOBValidation"/>
          </members>
        </fixedlist>
      </derivation>
    </Attribute>
    <Attribute name="duplicateCheck">
      <type>
        <ruleclass name="DuplicateClientCheck" ruleset="PDCDuplicateClientValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="DuplicateClientCheck" ruleset="PDCDuplicateClientValidationRuleSet">
          <specify attribute="concernRoleID">
            <reference attribute="participantRoleID">
              <reference attribute="related_participant">
                <reference attribute="evidence"/>
              </reference>
            </reference>
          </specify>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="fromDateAfterDOBValidation">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <choose>
            <type>
              <javaclass name="Boolean"/>
            </type>
            <when>
              <condition>
                <not>
                  <equals>
                    <reference attribute="dateOfBirth"/>
                    <null/>
                  </equals>
                </not>
              </condition>
              <value>
                <compare comparison="&gt;">
                  <reference attribute="dateOfBirth"/>
                  <reference attribute="fromDate">
                    <reference attribute="evidence"/>
                  </reference>
                </compare>
              </value>
            </when>
            <otherwise>
              <value>
                <false/>
              </value>
            </otherwise>
          </choose>
          <ResourceMessage key="ERR_RELATIONSHIPS_XRV_START_DATE"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet">
            <reference attribute="concernRoleName">
              <reference attribute="concernRoleRecord"/>
            </reference>
            <reference attribute="dateOfBirth"/>
          </ResourceMessage>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="fromDateBeforeDODValidation">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <choose>
            <type>
              <javaclass name="Boolean"/>
            </type>
            <when>
              <condition>
                <not>
                  <equals>
                    <reference attribute="dateOfDeath"/>
                    <null/>
                  </equals>
                </not>
              </condition>
              <value>
                <compare comparison="&gt;">
                  <reference attribute="fromDate">
                    <reference attribute="evidence"/>
                  </reference>
                  <reference attribute="dateOfDeath"/>
                </compare>
              </value>
            </when>
            <otherwise>
              <value>
                <false/>
              </value>
            </otherwise>
          </choose>
          <ResourceMessage key="ERR_RELATIONSHIPS_XRV_START_DATE_END_DATE"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet">
            <reference attribute="concernRoleName">
              <reference attribute="concernRoleRecord"/>
            </reference>
            <reference attribute="dateOfDeath"/>
          </ResourceMessage>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="toDateBeforeDODValidation">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <choose>
            <type>
              <javaclass name="Boolean"/>
            </type>
            <when>
              <condition>
                <not>
                  <equals>
                    <reference attribute="dateOfDeath"/>
                    <null/>
                  </equals>
                </not>
              </condition>
              <value>
                <reference attribute="nullTodate"/>
              </value>
            </when>
            <otherwise>
              <value>
                <false/>
              </value>
            </otherwise>
          </choose>
          <ResourceMessage key="ERR_RELATIONSHIPS_XRV_END_DATE"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet">
            <reference attribute="concernRoleName">
              <reference attribute="concernRoleRecord"/>
            </reference>
            <reference attribute="dateOfDeath"/>
          </ResourceMessage>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="nullTodate">
      <type>
        <javaclass name="Boolean"/>
      </type>
      <derivation>
        <choose>
          <type>
            <javaclass name="Boolean"/>
          </type>
          <when>
            <condition>
              <reference attribute="isTodateNull"/>
            </condition>
            <value>
              <compare comparison="&gt;">
                <reference attribute="toDate">
                  <reference attribute="evidence"/>
                </reference>
                <reference attribute="dateOfDeath"/>
              </compare>
            </value>
          </when>
          <otherwise>
            <value>
              <false/>
            </value>
          </otherwise>
        </choose>
      </derivation>
    </Attribute>

    <Attribute name="isTodateNull">
      <type>
        <javaclass name="Boolean"/>
      </type>
      <derivation>
        <choose>
          <type>
            <javaclass name="Boolean"/>
          </type>
          <when>
            <condition>
              <not>
                <equals>
                  <reference attribute="toDate">
                    <reference attribute="evidence"/>
                  </reference>
                  <null/>
                </equals>
              </not>
            </condition>
            <value>
              <true/>
            </value>
          </when>
          <otherwise>
            <value>
              <false/>
            </value>
          </otherwise>
        </choose>


      </derivation>


    </Attribute>
    <Attribute name="effectiveDateAfterDOBValidation">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <choose>
            <type>
              <javaclass name="Boolean"/>
            </type>
            <when>
              <condition>
                <all>
                  <fixedlist>
                    <listof>
                      <javaclass name="Boolean"/>
                    </listof>
                    <members>
                      <not>
                        <equals>
                          <reference attribute="dateOfBirth"/>
                          <null/>
                        </equals>
                      </not>
                      <not>
                        <equals>
                          <reference attribute="effectiveDate"/>
                          <null/>
                        </equals>
                      </not>
                    </members>
                  </fixedlist>
                </all>
              </condition>
              <value>
                <compare comparison="&gt;">
                  <reference attribute="dateOfBirth"/>
                  <reference attribute="effectiveDate"/>
                </compare>
              </value>
            </when>
            <otherwise>
              <value>
                <false/>
              </value>
            </otherwise>
          </choose>
          <ResourceMessage key="ERR_RELATIONSHIPS_XRV_EFFECTIVE_DATE_DOB"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet">
            <reference attribute="concernRoleName">
              <reference attribute="concernRoleRecord"/>
            </reference>
            <reference attribute="dateOfBirth"/>
          </ResourceMessage>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="concernRoleRecord">
      <type>
        <ruleclass name="ConcernRole" ruleset="ParticipantEntitiesRuleSet"/>
      </type>
      <derivation>
        <singleitem onEmpty="error" onMultiple="error">
          <readall ruleclass="ConcernRole" ruleset="ParticipantEntitiesRuleSet">
            <match retrievedattribute="concernRoleID">
              <reference attribute="participantRoleID">
                <reference attribute="related_participant">
                  <reference attribute="evidence"/>
                </reference>
              </reference>
            </match>
          </readall>
        </singleitem>
      </derivation>
    </Attribute>
    <Attribute name="modifyDuplicateClientValidation">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <reference attribute="isConcernRoleDuplicate">
            <reference attribute="duplicateCheck"/>
          </reference>
          <ResourceMessage key="ERR_RELATIONSHIPS_XRV_DUPLICATE_CLIENT_MODIFY"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet"/>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="createDuplicateClientValidation">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <reference attribute="isConcernRoleDuplicate">
            <reference attribute="duplicateCheck"/>
          </reference>
          <ResourceMessage key="ERR_RELATIONSHIPS_XRV_DUPLICATE_CLIENT_CREATE"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet"/>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="caseID">
      <type>
        <javaclass name="Number"/>
      </type>
      <derivation>
        <reference attribute="caseID">
          <reference attribute="evidence"/>
        </reference>
      </derivation>
    </Attribute>
    <Attribute name="birthAndDeathEvidence">
      <type>
        <javaclass name="List">
          <ruleclass name="BirthAndDeathEvidence" ruleset="ParticipantEvidenceRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <readall ruleclass="BirthAndDeathEvidence" ruleset="ParticipantEvidenceRuleSet">
          <match retrievedattribute="caseID">
            <reference attribute="caseID"/>
          </match>
        </readall>
      </derivation>
    </Attribute>
    <Attribute name="birthAndDeathEvidenceForClient">
      <type>
        <ruleclass name="BirthAndDeathEvidence" ruleset="ParticipantEvidenceRuleSet"/>
      </type>
      <derivation>
        <singleitem onEmpty="returnNull" onMultiple="returnFirst">
          <filter>
            <list>
              <reference attribute="birthAndDeathEvidence"/>
            </list>
            <listitemexpression>
              <all>
                <fixedlist>
                  <listof>
                    <javaclass name="Boolean"/>
                  </listof>
                  <members>
                    <not>
                      <equals>
                        <reference attribute="evidenceSuccessionID"/>
                        <reference attribute="successionID">
                          <current/>
                        </reference>
                      </equals>
                    </not>
                    <equals>
                      <reference attribute="participantRoleID">
                        <reference attribute="related_participant">
                          <reference attribute="evidence"/>
                        </reference>
                      </reference>
                      <reference attribute="participantRoleID">
                        <reference attribute="related_person">
                          <current/>
                        </reference>
                      </reference>
                    </equals>
                  </members>
                </fixedlist>
              </all>
            </listitemexpression>
          </filter>
        </singleitem>
      </derivation>
    </Attribute>
    <Attribute name="dateOfBirth">
      <type>
        <javaclass name="curam.util.type.Date"/>
      </type>
      <derivation>
        <choose>
          <type>
            <javaclass name="curam.util.type.Date"/>
          </type>
          <when>
            <condition>
              <not>
                <equals>
                  <reference attribute="birthAndDeathEvidenceForClient"/>
                  <null/>
                </equals>
              </not>
            </condition>
            <value>
              <reference attribute="dateOfBirth">
                <reference attribute="birthAndDeathEvidenceForClient"/>
              </reference>
            </value>
          </when>
          <otherwise>
            <value>
              <null/>
            </value>
          </otherwise>
        </choose>
      </derivation>
    </Attribute>
    <Attribute name="dateOfDeath">
      <type>
        <javaclass name="curam.util.type.Date"/>
      </type>
      <derivation>
        <choose>
          <type>
            <javaclass name="curam.util.type.Date"/>
          </type>
          <when>
            <condition>
              <not>
                <equals>
                  <reference attribute="birthAndDeathEvidenceForClient"/>
                  <null/>
                </equals>
              </not>
            </condition>
            <value>
              <reference attribute="dateOfDeath">
                <reference attribute="birthAndDeathEvidenceForClient"/>
              </reference>
            </value>
          </when>
          <otherwise>
            <value>
              <null/>
            </value>
          </otherwise>
        </choose>
      </derivation>
    </Attribute>
    <Attribute name="effectiveDate">
      <type>
        <javaclass name="curam.util.type.Date"/>
      </type>
      <derivation>
        <reference attribute="effectiveFrom">
          <reference attribute="evidence"/>
        </reference>
      </derivation>
    </Attribute>
    <Attribute name="validateTypeChanged">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <reference attribute="hasTypeBeenChanged"/>
          <ResourceMessage key="ERR_RELATIONSHIPS_FV_TYPE_CANNOT_BE_MODIFIED"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet"/>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="hasTypeBeenChanged">
      <type>
        <javaclass name="Boolean"/>
      </type>
      <derivation>
        <choose>
          <type>
            <javaclass name="Boolean"/>
          </type>
          <when>
            <condition>
              <equals>
                <reference attribute="status">
                  <reference attribute="evidence"/>
                </reference>
                <Code table="EvidenceDescriptorStatus">
                  <String value="EDS1"> </String>
                </Code>
              </equals>
            </condition>
            <value>
              <not>
                <equals>
                  <reference attribute="relationshipType">
                    <reference attribute="activeRelationshipEvidenceRow"/>
                  </reference>
                  <reference attribute="relationshipType">
                    <reference attribute="evidence"/>
                  </reference>
                </equals>
              </not>
            </value>
          </when>
          <otherwise>
            <value>
              <false/>
            </value>
          </otherwise>
        </choose>
      </derivation>
    </Attribute>
    <Attribute name="activeRelationshipEvidenceRow">
      <type>
        <ruleclass name="MolsaRelationship" ruleset="MolsaRelationshipRuleSet"/>
      </type>
      <derivation>
        <singleitem onEmpty="returnNull" onMultiple="returnFirst">
          <readall ruleclass="MolsaRelationship" ruleset="MolsaRelationshipRuleSet">
            <match retrievedattribute="correctionSetID">
              <reference attribute="correctionSetID">
                <reference attribute="evidence"/>
              </reference>
            </match>
          </readall>
        </singleitem>
      </derivation>
    </Attribute>
    <Attribute name="relativeDuplicateCheck">
      <type>
        <ruleclass name="DuplicateClientCheck" ruleset="PDCDuplicateClientValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="DuplicateClientCheck" ruleset="PDCDuplicateClientValidationRuleSet">
          <specify attribute="concernRoleID">
            <reference attribute="participantRoleID">
              <reference attribute="related_relatedParticipant">
                <reference attribute="evidence"/>
              </reference>
            </reference>
          </specify>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="relativeDuplicateClientValidation">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <reference attribute="isConcernRoleDuplicate">
            <reference attribute="relativeDuplicateCheck"/>
          </reference>
          <ResourceMessage key="ERR_RELATIONSHIPS_XRV_DUPLICATE_CLIENT_RELATIVE"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet"> </ResourceMessage>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="duplicateRelationshipValidation">
      <type>
        <ruleclass name="Validation" ruleset="EvidenceValidationRuleSet"/>
      </type>
      <derivation>
        <create ruleclass="Validation" ruleset="EvidenceValidationRuleSet">
          <reference attribute="isDuplicateRelationship"/>
          <ResourceMessage key="ERR_RELATIONSHIPS_XRV_DUPLICATE_RELATIONSHIP"
            resourceBundle="curam.evidence.MolsaRelationshipValidationRuleSet"> </ResourceMessage>
        </create>
      </derivation>
    </Attribute>
    <Attribute name="isDuplicateRelationship">
      <type>
        <javaclass name="Boolean"/>
      </type>
      <derivation>
        <compare comparison="&gt;">
          <property name="size">
            <object>
              <reference attribute="relationshipEvidenceByTypeAndParticipant"/>
            </object>
          </property>
          <Number value="0"/>
        </compare>
      </derivation>
    </Attribute>
    <Attribute name="relationshipEvidence">
      <type>
        <javaclass name="List">
          <ruleclass name="MolsaRelationship" ruleset="MolsaRelationshipRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <readall ruleclass="MolsaRelationship" ruleset="MolsaRelationshipRuleSet">
          <match retrievedattribute="caseID">
            <reference attribute="evidenceCaseID"/>
          </match>
        </readall>
      </derivation>
    </Attribute>
    <Attribute name="evidenceSuccessionID">
      <type>
        <javaclass name="Number"/>
      </type>
      <derivation>
        <reference attribute="successionID">
          <reference attribute="evidence"/>
        </reference>
      </derivation>
    </Attribute>
    <Attribute name="evidenceCaseID">
      <type>
        <javaclass name="Number"/>
      </type>
      <derivation>
        <reference attribute="caseID">
          <reference attribute="evidence"/>
        </reference>
      </derivation>
    </Attribute>
    <Attribute name="relationshipEvidenceByTypeAndParticipant">
      <type>
        <javaclass name="List">
          <ruleclass name="MolsaRelationship" ruleset="MolsaRelationshipRuleSet"/>
        </javaclass>
      </type>
      <derivation>
        <filter>
          <list>
            <reference attribute="relationshipEvidence"/>
          </list>
          <listitemexpression>
            <all>
              <fixedlist>
                <listof>
                  <javaclass name="Boolean"/>
                </listof>
                <members>
                  <equals>
                    <reference attribute="relationshipType">
                      <reference attribute="evidence"/>
                    </reference>
                    <reference attribute="relationshipType">
                      <current/>
                    </reference>
                  </equals>
                  <equals>
                    <reference attribute="participantRoleID">
                      <reference attribute="related_participant">
                        <reference attribute="evidence"/>
                      </reference>
                    </reference>
                    <reference attribute="participantRoleID">
                      <reference attribute="related_participant">
                        <current/>
                      </reference>
                    </reference>
                  </equals>
                  <equals>
                    <reference attribute="participantRoleID">
                      <reference attribute="related_relatedParticipant">
                        <reference attribute="evidence"/>
                      </reference>
                    </reference>
                    <reference attribute="participantRoleID">
                      <reference attribute="related_relatedParticipant">
                        <current/>
                      </reference>
                    </reference>
                  </equals>
                  <not>
                    <equals>
                      <reference attribute="evidenceSuccessionID"/>
                      <reference attribute="successionID">
                        <current/>
                      </reference>
                    </equals>
                  </not>
                </members>
              </fixedlist>
            </all>
          </listitemexpression>
        </filter>
      </derivation>
    </Attribute>
  </Class>
</RuleSet>
