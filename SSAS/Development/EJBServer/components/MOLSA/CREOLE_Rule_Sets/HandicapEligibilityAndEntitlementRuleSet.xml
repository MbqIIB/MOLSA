<?xml version="1.0" encoding="UTF-8"?>
<!-- Handicap Rule set. -->
<RuleSet xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../../../../../Curam/catalog/RuleSet.xsd"
    name="HandicapEligibilityAndEntitlementRuleSet">
	<Class name="HandicapCPRCalculator">
		<Initialization>
			<Attribute name="caseParticipantRoleRecord">
				<type>
					<ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/>
				</type>
			</Attribute>
		</Initialization>
		<Attribute name="memberCPRCalculator">
			<type>
				<ruleclass name="MemberCPRCalculator" ruleset="SocialAssistanceRuleSet"/>
			</type>
			<derivation>
				<create ruleclass="MemberCPRCalculator" ruleset="SocialAssistanceRuleSet">
					<reference attribute="caseParticipantRoleRecord"/>
				</create>
			</derivation>
		</Attribute>
		<Attribute name="isAgeBelowEighteenTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean"/>
				</javaclass>
			</type>
			<derivation>
				<timelineoperation>
					<compare comparison="&lt;">
						<intervalvalue>
							<reference attribute="ageTimeline">
								<reference attribute="memberCPRCalculator"/>
							</reference>
						</intervalvalue>
						<Number value="18"/>
					</compare>
				</timelineoperation>
			</derivation>
		</Attribute>
		
		<Attribute name="isSingleTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean"/>
				</javaclass>
			</type>
			<derivation>
			    <reference attribute="isSingleTimeline">
			        <reference attribute="memberCPRCalculator"/>
			    </reference>
			</derivation>
		</Attribute>
		<Attribute name="isHandicapTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean"/>
				</javaclass>
			</type>
			<derivation>
				<timelineoperation>
					<all>
						<fixedlist>
							<listof>
								<javaclass name="Boolean"/>
							</listof>
							<members>
								<intervalvalue>
									<reference attribute="isSingleTimeline"/>
								</intervalvalue>
								<intervalvalue>
									<reference attribute="isAgeBelowEighteenTimeline"/>
								</intervalvalue>
								<any>
									<dynamiclist>
										<list>
											<filter>
												<list>
													<readall ruleclass="UnableToWork"
														ruleset="UnableToWorkDataRuleSet">
														<match retrievedattribute="caseID">
															<reference attribute="caseID">
																<reference
																	attribute="caseParticipantRoleRecord"
																/>
															</reference>
														</match>
													</readall>
												</list>
												<listitemexpression>
													<equals>
														<reference attribute="caseParticipantRoleID">
															<reference
																attribute="caseParticipantRoleRecord"
															/>
														</reference>
														<reference attribute="participant">
															<current/>
														</reference>
													</equals>
												</listitemexpression>
											</filter>
										</list>
										<listitemexpression>
											<equals>
												<intervalvalue>
													<reference attribute="reason">
														<current/>
													</reference>
												</intervalvalue>
											    <Code table="MOLSAHCUnableToWork">
											        <String value="MHUW17000"/>
												</Code>
											</equals>
										</listitemexpression>
									</dynamiclist>
								</any>
							    <intervalvalue>
							        <reference attribute="isAgeBelowSixtyTimeline"/>
							    </intervalvalue>
							</members>
						</fixedlist>
					</all>
				</timelineoperation>
			</derivation>
		</Attribute>
	    <Attribute name="isAgeBelowSixtyTimeline">
	        <type>
	            <javaclass name="curam.creole.value.Timeline">
	                <javaclass name="Boolean"/>
	            </javaclass>
	        </type>
	        <derivation>
	            <timelineoperation>
	                <compare comparison="&lt;">
	                    <intervalvalue>
	                        <reference attribute="ageTimeline">
	                            <reference attribute="memberCPRCalculator"/>
	                        </reference>
	                    </intervalvalue>
	                    <Number value="60"/>
	                </compare>
	            </timelineoperation>
	        </derivation>
	    </Attribute>
	</Class>
    <Class name="HandicapEligibilityUnitCalculator" extendsRuleSet="SocialAssistanceRuleSet" extends="SocialAssistanceEligibilityUnitCalculator"
        xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
        <Attribute name="isEligibleTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Boolean"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <choose>
                        <type>
                            <javaclass name="Boolean"/>
                        </type>
                        <when>
                            <condition>
                                <compare comparison="&gt;">
                                    <property name="size">
                                        <object>
                                            <intervalvalue>
                                                <reference attribute="mandatoryEligibleMembersTimeline">
                                                    <reference attribute="eligibilityUnit"/>
                                                </reference>
                                            </intervalvalue>
                                        </object>
                                    </property> 
                                    <Number value="0"/>
                                </compare>
                            </condition>
                            <value>
                                <choose>
                                    <type>
                                        <javaclass name="Boolean"/>
                                    </type>
                                    <when>
                                        <condition>
                                            <not>
                                                <equals>
                                                    <null/>
                                                    <intervalvalue>
                                                        <reference attribute="handicapHouseholdMember"/>
                                                    </intervalvalue>
                                                </equals>
                                            </not>
                                        </condition>
                                        <value>
                                            <all>
                                                <fixedlist>
                                                    <listof>
                                                        <javaclass name="Boolean"/>
                                                    </listof>
                                                    <members>
                                                        <intervalvalue>
                                                            <reference attribute="hasPassedNonFinancialTestTimeline">
                                                                <create ruleclass="SANonFinancialCPRCalculator"
                                                                    ruleset="SocialAssistanceRuleSet">
                                                                    <reference attribute="caseParticipantRoleRecord">
                                                                        <intervalvalue>
                                                                            <reference attribute="handicapHouseholdMember"/>
                                                                        </intervalvalue>
                                                                    </reference>
                                                                </create>
                                                            </reference>
                                                        </intervalvalue>
                                                        <intervalvalue>
                                                            <reference attribute="hasHouseholdPassedIncomeTestTimeline"/>
                                                        </intervalvalue>
                                                        <not>
                                                            <intervalvalue>
                                                                <reference attribute="hasEarnedIncomeTimeline">
                                                                    <reference attribute="memberCPRCalculator">
                                                                        <intervalvalue>
                                                                            <reference attribute="handicapHouseholdMember"/>
                                                                        </intervalvalue>
                                                                    </reference>
                                                                </reference>
                                                            </intervalvalue> 
                                                        </not>
                                                    </members>
                                                </fixedlist>
                                            </all>
                                        </value>
                                    </when>
                                    <otherwise>
                                        <value>
                                            <false/>
                                        </value>
                                    </otherwise>
                                </choose>
                                 
                            </value>
                        </when>
                        <otherwise>
                            <value>
                                <false/>
                            </value>
                        </otherwise>
                    </choose>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="handicapHouseholdMember">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <ruleclass name="SAHouseholdUnitMember" ruleset="SocialAssistanceRuleSet"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <singleitem onEmpty="returnNull" onMultiple="returnFirst">
                        <filter>
                            <list>
                                <intervalvalue>
                                    <reference attribute="eligibleMembersTimeline">
                                        <reference attribute="eligibilityUnit"> </reference>
                                    </reference>
                                </intervalvalue>
                            </list>
                            <listitemexpression>
                                <not>
                                    <equals>
                                        <null/>
                                        <reference attribute="caseParticipantRoleRecord">
                                            <current/>
                                        </reference>
                                    </equals>
                                </not>
                            </listitemexpression>
                        </filter>
                    </singleitem>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="unearnedIncomeAmount">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Number"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <choose>
                        <type>
                            <javaclass name="Number"/>
                        </type>
                        <when>
                            <condition>
                                <not>
                                    <equals>
                                        <null/>
                                        <intervalvalue>
                                            <reference attribute="handicapHouseholdMember"/>
                                        </intervalvalue>
                                    </equals>
                                </not>
                            </condition>
                            <value>
                                <intervalvalue>
                                    <reference attribute="totalIncomeAmounntTimeline">
                                        <reference attribute="memberCPRCalculator">
                                            <intervalvalue>
                                                <reference attribute="handicapHouseholdMember"/>
                                            </intervalvalue>
                                        </reference>
                                    </reference>
                                </intervalvalue>
                            </value>
                        </when>
                        <otherwise>
                            <value>
                                <Number value="0"/>
                            </value>
                        </otherwise>
                    </choose>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="totalExpenseAmountTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Number"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <sum>
                        <dynamiclist>
                            <list alias="outer">
                                <intervalvalue>
                                    <reference attribute="mandatoryEligibleMembersTimeline">
                                        <reference attribute="eligibilityUnit"/>
                                    </reference>
                                </intervalvalue>
                            </list>
                            <listitemexpression>
                                <sum>
                                    <dynamiclist>
                                        <list alias="inner">
                                            <filter>
                                                <list alias="expenseRecord">
                                                    <reference attribute="expenseRecords">
                                                        <reference attribute="memberCPRCalculator">
                                                            <current alias="outer"/>
                                                        </reference>
                                                    </reference>
                                                </list>
                                                <listitemexpression>
                                                    <all>
                                                        <fixedlist>
                                                            <listof>
                                                                <javaclass name="Boolean"/>
                                                            </listof>
                                                            <members>
                                                                <equals>
                                                                    <reference attribute="rentType">
                                                                        <current alias="expenseRecord"/>
                                                                    </reference>
                                                                    <Code table="MOLSAExpense">
                                                                        <String value="MEX17000"/>
                                                                    </Code>
                                                                </equals>
                                                                <equals>
                                                                    <reference attribute="rentType">
                                                                        <current alias="expenseRecord"/>
                                                                    </reference>
                                                                    <Code table="MOLSAExpense">
                                                                        <String value="MEX17001"/>
                                                                    </Code>
                                                                </equals>
                                                            </members>
                                                        </fixedlist>
                                                    </all>
                                                </listitemexpression>
                                            </filter>
                                        </list>
                                        <listitemexpression>
                                            <intervalvalue>
                                                <reference attribute="rentAmount">
                                                    <current alias="inner"/>
                                                </reference>
                                            </intervalvalue>
                                        </listitemexpression>
                                    </dynamiclist>
                                </sum>
                            </listitemexpression>
                        </dynamiclist>
                    </sum>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="totalCountableIncomeTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Number"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <choose>
                        <type>
                            <javaclass name="Number"/>
                        </type>
                        <when>
                            <condition>
                                <compare comparison="&gt;">
                                    <intervalvalue>
                                        <reference attribute="unearnedIncomeAmount"/>
                                    </intervalvalue>
                                    <intervalvalue>
                                        <reference attribute="totalExpenseAmountTimeline"/>
                                    </intervalvalue>
                                </compare>
                            </condition>
                            <value>
                                <arithmetic operation="-">
                                    <intervalvalue>
                                        <reference attribute="unearnedIncomeAmount"/>
                                    </intervalvalue>
                                    <intervalvalue>
                                        <reference attribute="totalExpenseAmountTimeline"/>
                                    </intervalvalue>
                                </arithmetic>
                            </value>
                        </when>
                        <otherwise>
                            <value>
                                <Number value="0"/>
                            </value>
                        </otherwise>
                    </choose>
                </timelineoperation>
                
            </derivation>
        </Attribute>
		<Attribute name="hasHouseholdPassedIncomeTestTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Boolean" />
				</javaclass>
			</type>
			<derivation>
				<timelineoperation>
					<compare comparison="&lt;">
						<intervalvalue>
							<reference attribute="totalCountableIncomeTimeline" />
						</intervalvalue>
						<intervalvalue>
						<reference attribute="primaryBeneficiaryAmount" />
						</intervalvalue>
					</compare>
				</timelineoperation>
			</derivation>
		</Attribute>

	
		 <Attribute name="monthlyAmountTimeline">
			<type>
				<javaclass name="curam.creole.value.Timeline">
					<javaclass name="Number" />
				</javaclass>
			</type>
			<derivation>
				<timelineoperation>
					<choose>
						<type>
							<javaclass name="Number" />
						</type>
						<when>
							<condition>
								<compare comparison="&lt;">
									<intervalvalue>
										<reference attribute="totalCountableIncomeTimeline" />
									</intervalvalue>
									<intervalvalue>
										<reference attribute="primaryBeneficiaryAmount" />
									</intervalvalue>

								</compare>
							</condition>
							<value>
								<arithmetic operation="-">
									<intervalvalue>
										<reference attribute="primaryBeneficiaryAmount" />
									</intervalvalue>
									<intervalvalue>
										<reference attribute="totalCountableIncomeTimeline" />
									</intervalvalue>
								</arithmetic>
							</value>
						</when>
						<otherwise>
							<value>
								<Number value="0" />
							</value>
						</otherwise>
					</choose>
				</timelineoperation>
			</derivation>
		</Attribute>

		<Attribute name="primaryBeneficiaryAmount">
			<type>
			<javaclass name="curam.creole.value.Timeline">
				<javaclass name="Number" />
				</javaclass>
			</type>
			<derivation>
			<rate table="RTT17000" row="RR17003" column="RC17000"></rate>		
			</derivation>
		</Attribute>
    </Class>
    <Class name="HandicapDetermination"
        xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
        <Attribute name="caseID">
            <type>
                <javaclass name="Number"/>
            </type>
            <derivation>
                <specified/>
            </derivation>
        </Attribute>
        <Attribute name="simulatedDeterminationsForFilter">
            <type>
                <javaclass name="List">
                    <ruleclass name="SocialAssistanceSimulatedDetermination"
                        ruleset="SocialAssistanceRuleSet"/>
                </javaclass>
            </type>
            <derivation>
                <specified/>
            </derivation>
        </Attribute>
        <Attribute name="householdUnits">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="List">
                        <ruleclass name="SAHouseholdUnitCalculator"
                            ruleset="SocialAssistanceRuleSet"/>
                    </javaclass>
                </javaclass>
            </type>
            <derivation>
                <reference attribute="householdUnits">
                    <create ruleclass="HandicapHouseholdComposition">
                        <specify attribute="caseID">
                            <reference attribute="caseID"/>
                        </specify>
                        <specify attribute="membersForHouseholdComposition">
                            <reference attribute="membersForHouseholdComposition">
                                <create ruleclass="MembersForHCDetermination"
                                    ruleset="SocialAssistanceRuleSet">
                                    <reference attribute="caseID"/>
                                    <reference attribute="simulatedDeterminationsForFilter"/>
                                </create>
                            </reference>
                        </specify>
                    </create>
                </reference>
            </derivation>
        </Attribute>
        <Attribute name="units">
            <type>
                <javaclass name="List">
                    <ruleclass name="SAHouseholdUnitCalculator" ruleset="SocialAssistanceRuleSet"/>
                </javaclass>
            </type>
            <derivation>
                <call class="curam.socialassistance.creole.statics.impl.Statics"
                    method="getUniqueRuleObjects">
                    <type>
                        <javaclass name="List">
                            <ruleclass name="SAHouseholdUnitCalculator"
                                ruleset="SocialAssistanceRuleSet"/>
                        </javaclass>
                    </type>
                    <arguments>
                        <timelineoperation>
                            <filter>
                                <list>
                                    <intervalvalue>
                                        <reference attribute="filteredHouseholdUnits">
                                            <create ruleclass="HouseholdUnitsFilterCalculator"
                                                ruleset="SocialAssistanceRuleSet">
                                                <reference attribute="householdUnits"/>
                                                <reference attribute="caseID"/>
                                            </create>
                                        </reference>
                                    </intervalvalue>
                                </list>
                                <listitemexpression>
                                    <compare comparison="&gt;">
                                        <property name="size">
                                            <object>
                                                <intervalvalue>
                                                    <reference
                                                        attribute="mandatoryEligibleMembersTimeline">
                                                        <current/>
                                                    </reference>
                                                </intervalvalue>
                                            </object>
                                        </property>
                                        <Number value="0"/>
                                    </compare>
                                </listitemexpression>
                            </filter>
                        </timelineoperation>
                    </arguments>
                </call>
            </derivation>
        </Attribute>
        <Attribute name="handicapSimulatedDeterminations">
            <type>
                <javaclass name="List">
                    <ruleclass name="HandicapSimulatedDetermination"/>
                </javaclass>
            </type>
            <derivation>
                <dynamiclist>
                    <list>
                        <reference attribute="units"/>
                    </list>
                    <listitemexpression>
                        <create ruleclass="HandicapSimulatedDetermination">
                            <specify attribute="caseID">
                                <reference attribute="caseID"/>
                            </specify>
                            <specify attribute="unit">
                                <current/>
                            </specify>
                            <specify attribute="isValidUnitTimeline">
                                <timelineoperation>
                                    <property name="contains">
                                        <object>
                                            <intervalvalue>
                                                <reference attribute="householdUnits"/>
                                            </intervalvalue>
                                        </object>
                                        <arguments>
                                            <current/>
                                        </arguments>
                                    </property>
                                </timelineoperation>
                            </specify>
                        </create>
                    </listitemexpression>
                </dynamiclist>
            </derivation>
        </Attribute>
    </Class>
    <Class extends="SocialAssistanceSimulatedDetermination" extendsRuleSet="SocialAssistanceRuleSet"
        name="HandicapSimulatedDetermination"
        xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
        <Attribute name="programRecommendationCase">
            <type>
                <ruleclass name="SocialAssistanceProductCase" ruleset="SocialAssistanceRuleSet"/>
            </type>
            <derivation>
                <reference attribute="handicapProgramRecommendationCase"/>
            </derivation>
        </Attribute>
        <Attribute name="productID">
            <type>
                <javaclass name="Number"/>
            </type>
            <derivation>
                <Number value="45001"/>
            </derivation>
        </Attribute>
        <Attribute name="handicapProgramRecommendationCase">
            <type>
                <ruleclass name="HandicapProductCase"/>
            </type>
            <derivation>
                <create ruleclass="HandicapProductCase">
                    <specify attribute="eligibilityUnit">
                        <reference attribute="unit"/>
                    </specify>
                    <specify attribute="productDeliveryCase">
                        <reference attribute="simulatedProductDeliveryCase"/>
                    </specify>
                    <specify attribute="isValidUnitTimeline">
                        <reference attribute="isValidUnitTimeline"/>
                    </specify>
                </create>
            </derivation>
        </Attribute>
        <Attribute name="saNonFinancialCategory">
            <type>
                <ruleclass name="SANonFinancialCategory" ruleset="SocialAssistanceDisplayRuleSet"/>
            </type>
            <derivation>
                <create ruleclass="SANonFinancialCategory" ruleset="SocialAssistanceDisplayRuleSet">
                    <specify
                        attribute="coverageTypeNonFinancialCategory">
                <create ruleclass="HandicapNonFinancialCategory" ruleset="HandicapDisplayRuleSet">
                    <specify attribute="productCase">
                        <reference attribute="handicapProgramRecommendationCase"/>
                    </specify>
                    <specify attribute="productDeliveryCase">
                        <reference attribute="simulatedProductDeliveryCase"/>
                    </specify>
                </create>
                    </specify>
                    <specify attribute="displayCategoryID">
                        <Number value="4500"/>
                    </specify>
                </create>
            </derivation>
        </Attribute>
        <Attribute name="programRecommendationDisplayCases">
			<type>
				<javaclass name="List">
					<ruleclass name="ProgramRecommendationDisplayCase"
						ruleset="ProgramRecommendationDisplayRuleSet"/>
				</javaclass>
			</type>
			<derivation>
				<fixedlist>
					<listof>
						<ruleclass name="ProgramRecommendationDisplayCase"
							ruleset="ProgramRecommendationDisplayRuleSet"/>
					</listof>
					<members>
					    <reference attribute="handicapSummaryCategory"/>
					    <reference attribute="saNonFinancialCategory"/>
					    <reference attribute="saHhIncomeCategory"/>
					</members>
				</fixedlist>
			</derivation>
		</Attribute>
        <Attribute name="handicapSummaryCategory">
            <type>
                <ruleclass name="HandicapSummaryCategory" ruleset="HandicapDisplayRuleSet"/>
            </type>
            <derivation>
                <create ruleclass="HandicapSummaryCategory" ruleset="HandicapDisplayRuleSet">
                    <specify attribute="handicapProductCase">
                        <reference attribute="handicapProgramRecommendationCase"/>
                    </specify>
                    <specify attribute="productDeliveryCase">
                        <reference attribute="simulatedProductDeliveryCase"/>
                    </specify>
                    <specify attribute="displayCategoryID">
                        <Number value="4504"/>
                    </specify>
                </create>
            </derivation>
        </Attribute>
		<Attribute name="saHhIncomeCategory">
			<type>
			    <ruleclass name="SAHouseholdIncomeCategory" ruleset="SocialAssistanceDisplayRuleSet"/>
			</type>
			<derivation>
			    <create ruleclass="SAHouseholdIncomeCategory" ruleset="SocialAssistanceDisplayRuleSet">
			        <specify
			            attribute="coverageTypeHouseholdIncomeCategory">
			            <create
			                ruleclass="HandicapHouseholdIncomeCategory"
			                ruleset="HandicapDisplayRuleSet"
			                >
			                <specify
			                    attribute="productCase">
			                    <reference
			                        attribute="handicapProgramRecommendationCase"/>
			                </specify>
			                <specify
			                    attribute="productDeliveryCase">
			                    <reference
			                        attribute="simulatedProductDeliveryCase"/>
			                </specify>
			            </create>
			        </specify>
					<specify attribute="displayCategoryID">
					    <Number value="4502"/>
					</specify>
				</create>
			</derivation>
		</Attribute>
    </Class>
    <Class extends="SocialAssistanceProductCase" extendsRuleSet="SocialAssistanceRuleSet"
        name="HandicapProductCase"
        xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
        <Attribute name="caseID">
            <type>
                <javaclass name="Number"/>
            </type>
            <derivation>
                <reference attribute="caseID">
                    <reference attribute="productDeliveryCase"/>
                </reference>
            </derivation>
        </Attribute>
        <Attribute name="caseHeaderRecord">
            <type>
                <ruleclass name="CaseHeader" ruleset="CaseEntitiesRuleSet"/>
            </type>
            <derivation>
                <singleitem onEmpty="error" onMultiple="error">
                    <readall ruleclass="CaseHeader" ruleset="CaseEntitiesRuleSet">
                        <match retrievedattribute="caseID">
                            <reference attribute="caseID"/>
                        </match>
                    </readall>
                </singleitem>
            </derivation>
        </Attribute>
        <Attribute name="primaryClientCPRRecord">
            <type>
                <ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/>
            </type>
            <derivation>
                <singleitem onEmpty="error" onMultiple="returnFirst">
                    <filter>
                        <list>
                            <readall ruleclass="CaseParticipantRole" ruleset="CaseEntitiesRuleSet">
                                <match retrievedattribute="caseID">
                                    <reference attribute="parentIntegratedCaseID"/>
                                </match>
                            </readall>
                        </list>
                        <listitemexpression>
                            <all>
                                <fixedlist>
                                    <listof>
                                        <javaclass name="Boolean"/>
                                    </listof>
                                    <members>
                                        <equals>
                                            <reference attribute="participantRoleID">
                                                <current/>
                                            </reference>
                                            <reference attribute="concernRoleID">
                                                <reference attribute="caseHeaderRecord"/>
                                            </reference>
                                        </equals>
                                        <any>
                                            <fixedlist>
                                                <listof>
                                                  <javaclass name="Boolean"/>
                                                </listof>
                                                <members>
                                                  <equals>
                                                  <reference attribute="typeCode">
                                                  <current/>
                                                  </reference>
                                                  <Code table="CaseParticipantRoleType">
                                                  <String value="PRI"/>
                                                  </Code>
                                                  </equals>
                                                  <equals>
                                                  <reference attribute="typeCode">
                                                  <current/>
                                                  </reference>
                                                  <Code table="CaseParticipantRoleType">
                                                  <String value="MEM"/>
                                                  </Code>
                                                  </equals>
                                                </members>
                                            </fixedlist>
                                        </any>
                                    </members>
                                </fixedlist>
                            </all>
                        </listitemexpression>
                    </filter>
                </singleitem>
            </derivation>
        </Attribute>
        <Attribute name="parentIntegratedCaseID">
            <type>
                <javaclass name="Number"/>
            </type>
            <derivation>
                <choose>
                    <type>
                        <javaclass name="Number"/>
                    </type>
                    <when>
                        <condition>
                            <reference attribute="isProductDelivery"/>
                        </condition>
                        <value>
                            <reference attribute="integratedCaseID">
                                <reference attribute="caseHeaderRecord"/>
                            </reference>
                        </value>
                    </when>
                    <otherwise>
                        <value>
                            <reference attribute="caseID"/>
                        </value>
                    </otherwise>
                </choose>
            </derivation>
        </Attribute>
        <Attribute name="isProductDelivery">
            <type>
                <javaclass name="Boolean"/>
            </type>
            <derivation>
                <equals>
                    <reference attribute="caseTypeCode">
                        <reference attribute="caseHeaderRecord"/>
                    </reference>
                    <Code table="CaseTypeCode">
                        <String value="CT2"/>
                    </Code>
                </equals>
            </derivation>
        </Attribute>
        <Attribute name="householdUnits">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="List">
                        <ruleclass name="SAHouseholdUnitCalculator"
                            ruleset="SocialAssistanceRuleSet"/>
                    </javaclass>
                </javaclass>
            </type>
            <derivation>
                <reference attribute="householdUnits">
                    <create ruleclass="HandicapHouseholdComposition">
                        <specify attribute="caseID">
                            <reference attribute="parentIntegratedCaseID"/>
                        </specify>
                        <specify attribute="membersForHouseholdComposition">
                            <reference attribute="membersForHouseholdComposition">
                                <create ruleclass="MembersForHCDetermination"
                                    ruleset="SocialAssistanceRuleSet">
                                    <reference attribute="parentIntegratedCaseID"/>
                                    <fixedlist>
                                        <listof>
                                            <ruleclass name="SocialAssistanceSimulatedDetermination"
                                                ruleset="SocialAssistanceRuleSet"/>
                                        </listof>
                                        <members/>
                                    </fixedlist>
                                </create>
                            </reference>
                        </specify>
                    </create>
                </reference>
            </derivation>
        </Attribute>
        <Attribute name="handicapHouseholdMember">
            <type>
                <ruleclass name="SAHouseholdUnitMember" ruleset="SocialAssistanceRuleSet"/>
            </type>
            <derivation>
                <create ruleclass="SAHouseholdUnitMember" ruleset="SocialAssistanceRuleSet">
                    <reference attribute="parentIntegratedCaseID"/>
                    <reference attribute="primaryClientCPRRecord"/>
                </create>
            </derivation>
        </Attribute>
        <Attribute name="eligibilityUnit">
            <type>
                <ruleclass name="SAHouseholdUnitCalculator" ruleset="SocialAssistanceRuleSet"/>
            </type>
            <derivation>
                <singleitem onEmpty="returnNull" onMultiple="returnLast">
                    <call class="curam.socialassistance.creole.statics.impl.Statics"
                        method="getUniqueRuleObjects">
                        <type>
                            <javaclass name="List">
                                <ruleclass name="SAHouseholdUnitCalculator"
                                    ruleset="SocialAssistanceRuleSet"/>
                            </javaclass>
                        </type>
                        <arguments>
                            <timelineoperation>
                                <fixedlist>
                                    <listof>
                                        <ruleclass name="SAHouseholdUnitCalculator"
                                            ruleset="SocialAssistanceRuleSet"/>
                                    </listof>
                                    <members>
                                        <choose>
                                            <type>
                                                <ruleclass name="SAHouseholdUnitCalculator"
                                                    ruleset="SocialAssistanceRuleSet"/>
                                            </type>
                                            <when>
                                                <condition>
                                                    <intervalvalue>
                                                        <reference attribute="isHandicapTimeline">
                                                            <create ruleclass="HandicapCPRCalculator">
                                                                <reference attribute="primaryClientCPRRecord"/>
                                                            </create>
                                                        </reference>
                                                    </intervalvalue>
                                                </condition>
                                                <value>
                                                    <create ruleclass="SAHouseholdUnitCalculator"
                                                        ruleset="SocialAssistanceRuleSet">
                                                        <specify attribute="mandatoryEligibleMembersTimeline">
                                                            <timelineoperation>
                                                                <fixedlist>
                                                                    <listof>
                                                                        <ruleclass name="SAHouseholdUnitMember" ruleset="SocialAssistanceRuleSet"/>
                                                                    </listof>
                                                                    <members>
                                                                        <reference attribute="handicapHouseholdMember"/>
                                                                    </members>
                                                                </fixedlist>
                                                            </timelineoperation>
                                                        </specify>
                                                    </create> 
                                                </value>
                                            </when>
                                            <otherwise>
                                                <value>
                                                    <create ruleclass="SAHouseholdUnitCalculator"
                                                        ruleset="SocialAssistanceRuleSet"/>
                                                </value>
                                            </otherwise>
                                        </choose> 
                                    </members>
                                </fixedlist>
                            </timelineoperation>
                        </arguments>
                    </call>
                </singleitem>
            </derivation>
        </Attribute>
        <Attribute name="primaryAndMemberCaseParticipantRoleRecords">
            <type>
                <javaclass name="List">
                    <ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/>
                </javaclass>
            </type>
            <derivation>
                <fixedlist>
                    <listof>
                        <ruleclass name="CaseParticipantRole" ruleset="CaseEntitiesRuleSet"/> 
                    </listof>
                    <members>
                        <reference attribute="primaryClientCPRRecord"/>
                    </members>
                </fixedlist>
            </derivation>
        </Attribute>
        <Attribute name="programRecommendationObjectiveTimelines">
            <type>
                <javaclass name="List">
                    <ruleclass name="AbstractObjectiveTimeline"
                        ruleset="ProductEligibilityEntitlementRuleSet"/>
                </javaclass>
            </type>
            <derivation>
                <reference attribute="objectiveTimelines">
                    <reference attribute="socialAssistanceObjectiveCalculator"/>
                </reference>
            </derivation>
        </Attribute>
        <Attribute name="handicapProgramCalculator">
            <type>
                <ruleclass name="HandicapProgramCalculator"/>
            </type>
            <derivation>
                <create ruleclass="HandicapProgramCalculator">
                    <reference attribute="parentIntegratedCaseID"/>
                    <reference attribute="eligibilityUnit"/>
                </create>
            </derivation>
        </Attribute>
        
        
        <Attribute name="handicapEligibilityUnitCalculatorTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <ruleclass name="HandicapEligibilityUnitCalculator"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <intervalvalue>
                        <reference attribute="handicapEligibilityUnitCalculator">
                            <reference attribute="handicapProgramCalculator"/>
                        </reference>
                    </intervalvalue>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="monthlyAmountTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Number"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <choose>
                        <type>
                            <javaclass name="Number"/>
                        </type>
                        <when>
                            <condition>
                                <intervalvalue>
                                    <reference attribute="isEligibleTimeline"/>
                                </intervalvalue>
                            </condition>
                            <value>
                                <intervalvalue>
                                    <reference attribute="monthlyAmountTimeline">
                                        <intervalvalue>
                                            <reference attribute="handicapEligibilityUnitCalculatorTimeline"/>
                                        </intervalvalue>
                                    </reference>
                                </intervalvalue>
                            </value>
                        </when>
                        <otherwise>
                            <value>
                                <Number value="0"/>
                            </value>
                        </otherwise>
                    </choose>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="socialAssistanceObjectiveCalculator">
            <type>
                <ruleclass name="SocialAssistanceObjectiveCalculator" ruleset="SocialAssistanceRuleSet"/>
            </type>
            <derivation>
                <create ruleclass="SocialAssistanceObjectiveCalculator" ruleset="SocialAssistanceRuleSet">
                    <reference attribute="handicapEligibilityUnitCalculatorTimeline"/>
                    <reference attribute="primaryAndMemberCaseParticipantRoleRecords"/>
                </create>
            </derivation>
        </Attribute>
        <Attribute name="objectiveTimelines">
            <type>
                <javaclass name="List">
                    <ruleclass name="SocialAssistanceObjectiveTimeline"
                        ruleset="SocialAssistanceRuleSet"/>
                </javaclass>
            </type>
            <derivation>
                <reference attribute="objectiveTimelines">
                    <reference attribute="socialAssistanceObjectiveCalculator"/>
                </reference>
            </derivation>
        </Attribute>
        <Attribute name="householdUnitForPD">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <ruleclass name="SAHouseholdUnitCalculator" ruleset="SocialAssistanceRuleSet"/> 
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <choose>
                        <type>
                            <ruleclass name="SAHouseholdUnitCalculator"
                                ruleset="SocialAssistanceRuleSet"/>
                        </type>
                        <when>
                            <condition>
                                <intervalvalue>
                                    <reference attribute="isHandicapTimeline">
                                        <create ruleclass="HandicapCPRCalculator">
                                            <reference attribute="primaryClientCPRRecord"/>
                                        </create>
                                    </reference>
                                </intervalvalue>
                            </condition>
                            <value>
                                <create ruleclass="SAHouseholdUnitCalculator"
                                    ruleset="SocialAssistanceRuleSet">
                                    <specify attribute="mandatoryEligibleMembersTimeline">
                                        <timelineoperation>
                                            <fixedlist>
                                                <listof>
                                                    <ruleclass name="SAHouseholdUnitMember" ruleset="SocialAssistanceRuleSet"/>
                                                </listof>
                                                <members>
                                                    <reference attribute="handicapHouseholdMember"/>
                                                </members>
                                            </fixedlist>
                                        </timelineoperation>
                                    </specify>
                                </create>
                            </value>
                        </when>
                        <otherwise>
                            <value>
                                <create ruleclass="SAHouseholdUnitCalculator"
                                    ruleset="SocialAssistanceRuleSet"/>
                            </value>
                        </otherwise>
                    </choose>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="isValidUnitTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Boolean"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <choose>
                        <type>
                            <javaclass name="Boolean"/>
                        </type>
                        <when>
                            <condition>
                                <compare comparison="&gt;">
                                    <property name="size">
                                        <object>
                                            <intervalvalue>
                                                <reference attribute="mandatoryEligibleMembersTimeline">
                                                    <intervalvalue>
                                                        <reference attribute="householdUnitForPD"/>
                                                    </intervalvalue>
                                                </reference>
                                            </intervalvalue>
                                        </object>
                                    </property>
                                    <Number value="0"/>
                                </compare>
                            </condition>
                            <value>
                                <true/>
                            </value>
                        </when>
                        <otherwise>
                            <value>
                                <false/>
                            </value>
                        </otherwise>
                    </choose>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="isEligibleTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Boolean"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <all>
                        <fixedlist>
                            <listof>
                                <javaclass name="Boolean"/>
                            </listof>
                            <members>
                                <intervalvalue>
                                    <reference attribute="isValidUnitTimeline"/>
                                </intervalvalue>
                                <intervalvalue>
                                    <reference attribute="isEligibleTimeline">
                                        <reference attribute="handicapProgramCalculator"/>
                                    </reference>
                                </intervalvalue>
                            </members>
                        </fixedlist>
                    </all>
                </timelineoperation>
            </derivation>
        </Attribute>
    </Class>
    <Class  extends="SocialAssistanceProduct" extendsRuleSet="SocialAssistanceRuleSet"
        name="HandicapProduct"
        xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
        <Attribute name="description">
            <type>
                <javaclass name="curam.creole.value.Message"/>
            </type>
            <derivation>
                <XmlMessage>Handicap Product</XmlMessage>
            </derivation>
        </Attribute>
    </Class>
    <Class name="HandicapProgramCalculator"
        xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
        <Initialization>
            <Attribute name="caseID">
                <type>
                    <javaclass name="Number"/>
                </type>
            </Attribute>
            <Attribute name="eligibilityUnit">
                <type>
                    <ruleclass name="SAHouseholdUnitCalculator" ruleset="SocialAssistanceRuleSet"/>
                </type>
            </Attribute>
        </Initialization>
        <Attribute name="handicapEligibilityUnitCalculator">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <ruleclass name="HandicapEligibilityUnitCalculator"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <create ruleclass="HandicapEligibilityUnitCalculator">
                        <reference attribute="caseID"/>
                        <reference attribute="eligibilityUnit"/>
                    </create>
                </timelineoperation>
            </derivation>
        </Attribute>
        <Attribute name="isEligibleTimeline">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="Boolean"/>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <intervalvalue>
                        <reference attribute="isEligibleTimeline">
                            <intervalvalue>
                                <reference attribute="handicapEligibilityUnitCalculator"/>
                            </intervalvalue>
                        </reference>
                    </intervalvalue>
                </timelineoperation>
            </derivation>
        </Attribute>
    </Class>
    <Class name="HandicapHouseholdComposition" extends="SocialAssistanceHouseholdComposition" extendsRuleSet="SocialAssistanceRuleSet"
        xsi:noNamespaceSchemaLocation="http://www.curamsoftware.com/CreoleRulesSchema.xsd">
        <Attribute name="membersForHouseholdComposition">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="List">
                        <ruleclass name="SAHouseholdUnitMember" ruleset="SocialAssistanceRuleSet"/>
                    </javaclass>
                </javaclass>
            </type>
            <derivation>
                <specified/>
            </derivation>
        </Attribute>
        <Attribute name="householdUnits">
            <type>
                <javaclass name="curam.creole.value.Timeline">
                    <javaclass name="List">
                        <ruleclass name="SAHouseholdUnitCalculator"
                            ruleset="SocialAssistanceRuleSet"/>
                    </javaclass>
                </javaclass>
            </type>
            <derivation>
                <timelineoperation>
                    <dynamiclist>
                        <list>
                            <intervalvalue>
                                <reference attribute="membersForHouseholdComposition"/>
                            </intervalvalue>
                        </list>
                        <listitemexpression>
                            <choose>
                                <type>
                                        <ruleclass name="SAHouseholdUnitCalculator" ruleset="SocialAssistanceRuleSet"/>
                                </type>
                                <when>
                                    <condition>
                                        <intervalvalue>
                                        	<reference attribute="isHandicapTimeline">
                                                <create ruleclass="HandicapCPRCalculator">
                                                    <reference attribute="caseParticipantRoleRecord">
                                                       <current/>
                                                    </reference>
                                                </create>
                                            </reference>
                                        </intervalvalue>
                                    </condition>
                                    <value>  
                                        <create ruleclass="SAHouseholdUnitCalculator"
                                            ruleset="SocialAssistanceRuleSet">
                                            <specify attribute="mandatoryEligibleMembersTimeline">
                                                <timelineoperation>
                                                    <fixedlist>
                                                        <listof>
                                                            <ruleclass name="SAHouseholdUnitMember" ruleset="SocialAssistanceRuleSet"/>
                                                        </listof>
                                                        <members>
                                                            <current/>
                                                        </members>
                                                    </fixedlist>
                                                </timelineoperation>
                                            </specify>
                                        </create>
                                    </value>
                                </when>
                                <otherwise>
                                    <value>
                                        <create ruleclass="SAHouseholdUnitCalculator" ruleset="SocialAssistanceRuleSet"/>
                                    </value>
                                </otherwise>
                            </choose>
                        </listitemexpression>
                    </dynamiclist>
                </timelineoperation>
            </derivation>
        </Attribute>
    </Class>

    
    
    
    
    
    
</RuleSet>
