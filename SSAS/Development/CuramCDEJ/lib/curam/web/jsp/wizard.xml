<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed Materials - Property of IBM

  Copyright IBM Corporation 2012. All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or disclosure
  restricted by GSA ADP Schedule Contract with IBM Corp.
-->
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:curam="http://www.curamsoftware.com/curam"
          version="2.0">
  <jsp:directive.page buffer="32kb"
                      contentType="text/html;charset=UTF-8"
                      isErrorPage="false"
                      language="java"
                      isELIgnored="false"
                      pageEncoding="UTF-8"/>
  <jsp:output omit-xml-declaration="yes"/>
  <curam:userPreferences/>  
      <jsp:scriptlet>
        String ctx =
              request.getParameter(curam.omega3.taglib.ScreenContext.CTX_PARAM);
        curam.omega3.taglib.ScreenContext agendaContext =
                                        new curam.omega3.taglib.ScreenContext();
        agendaContext.clearLayout();
        if (ctx != null &amp;&amp; !ctx.equals("")) {
          agendaContext.set(ctx);
        }
        agendaContext.clearStates();
        if (agendaContext.hasContextBits(
            curam.omega3.taglib.ScreenContext.TAB)) {
          
          if (agendaContext.hasContextBits(
              curam.omega3.taglib.ScreenContext.MODAL)) {
            
            pageContext.setAttribute("contextError","false");
          
          } else {
            pageContext.setAttribute("contextError","true");
          }
        }
        agendaContext.clear(curam.omega3.taglib.ScreenContext.TREE
            | curam.omega3.taglib.ScreenContext.TAB);
        agendaContext.addContextBits(curam.omega3.taglib.ScreenContext.AGENDA);
        pageContext.setAttribute("currentContext",agendaContext.getValue());
      </jsp:scriptlet>
  <c:url value="" var="navUrl">
    <c:forEach var="current" items="${param}">
      <c:forEach var="paramValue" items="${paramValues[current.key]}">
        <c:choose>
        <c:when test="${current.key=='o3ctx'}">
          <c:param name="o3ctx" value="${currentContext}"/>
        </c:when>
        <c:otherwise>
          <c:param name="${current.key}" value="${paramValue}"/>
        </c:otherwise>
        </c:choose>
      </c:forEach>
    </c:forEach>
    <c:if test="${empty param.o3ctx}">
      <c:param name="o3ctx" value="${currentContext}"/>
    </c:if>
  </c:url>
  <jsp:scriptlet>
    
    pageContext.setAttribute("wizard_frameset_title", 
      curam.omega3.util.CDEJResources.getProperty("wizard.frameset.title"));
    pageContext.setAttribute("wizard_header_frame_title", 
      curam.omega3.util.CDEJResources.getProperty("wizard.header.frame.title"));
    pageContext.setAttribute("wizard_navigation_frame_title", 
      curam.omega3.util.CDEJResources.getProperty("wizard.navigation.frame.title"));
    pageContext.setAttribute("wizard_content_frame_title", 
      curam.omega3.util.CDEJResources.getProperty("wizard.content.frame.title"));
    pageContext.setAttribute("wizard_button_frame_title", 
      curam.omega3.util.CDEJResources.getProperty("wizard.button.frame.title"));
      
  </jsp:scriptlet>
  
  <c:url var="headerUrl" value="wizard-header.jspx"/>
  <c:url var="buttonsUrl" value="wizardnav.jspx"/>
<jsp:text><![CDATA[<!DOCTYPE html>]]></jsp:text>
  <jsp:scriptlet><![CDATA[out.print("<html lang=\"");]]></jsp:scriptlet>
    <c:out value="${htmlLanguage}"/> 
    <jsp:scriptlet><![CDATA[out.print("\" >");]]></jsp:scriptlet>
    <head>
      <title><c:out value="${wizard_frameset_title}"/></title>
      <script type="text/javascript" src="/CDEJ/jscript/dojotk/dojo/dojo.js" data-dojo-config="async:0,parseOnLoad:true"/>
      <script type="text/javascript">
      <jsp:scriptlet>curam.util.client.jsp.JspUtil.outputJSModulePaths(pageContext);</jsp:scriptlet>
      </script>
      <link rel="stylesheet" media="all" type="text/css" href="../themes/v6/css/v6_main.css" />
      <script type="text/javascript" src="/CDEJ/jscript/cdej-cm.js">// script content</script>
      <script type="text/javascript" src="/CDEJ/jscript/cdej.js">// script content</script>
      <script type="text/javascript">
        require(["curam/core-uim", "curam/dialog"]);
      </script>
      <script src="/CDEJ/jscript/wizardFrameset.js" type="text/javascript">// script content</script>
      <script type="text/javascript">
        var wizard = new Wizard();
        window.rootObject = 'wizard';
        var jsBaseURL = curam.util.retrieveBaseURL();
        var jsScreenContext = new curam.util.ScreenContext();
        <jsp:scriptlet><![CDATA[out.print("jsScreenContext.setContext('");]]></jsp:scriptlet>
        <c:out value="${currentContext}"/>
        <jsp:scriptlet><![CDATA[out.print("');");]]></jsp:scriptlet>

        if (jsScreenContext.hasContextBits('MODAL')) {
        	require(["curam/wizard"]);
        	curam.wizard.setupTargetFrameForModals('<c:out value="${wizard_frameset_title}"/>');
        } 
      </script>
      <curam:jsUserPreferences />
      <script type="text/javascript">
        function getIdFromUrl(navUrl) {
          return navUrl.substring(0, navUrl.indexOf('Frame.do'));
        }
        curam.util.onLoad.addPublisher(function(context){
          context.helpEnabled = jsHelpEnabled;
          context.helpExtension = jsHelpExtension;
          context.pageID = getIdFromUrl('<c:out value="${navUrl}"/>');
        });
      </script>
    </head>
    <c:if test="${contextError=='true'}">
      <body>
        <div><img src="/themes/classic/images/icons/error.gif"/><span class="errorText">The Agenda Player widget is not supported in the Content Panel of the tabbed application.
            Please open Agenda Player in the modal dialog instead.</span>
        </div>
      </body>
    </c:if>
    
    <c:if test="${empty contextError || contextError=='false'}">
    <jsp:scriptlet><![CDATA[out.print("<frameset rows=\"22,*,33\" border=\"0\" class=\"outer-frame\" title=\"");]]></jsp:scriptlet>
    <c:out value="${wizard_frameset_title}"/> 
    <jsp:scriptlet><![CDATA[out.print("\" >");]]></jsp:scriptlet>
      <jsp:scriptlet><![CDATA[out.print("<frame src=\"");]]></jsp:scriptlet>
      <c:out value="${headerUrl}"/>
      <jsp:scriptlet><![CDATA[out.print("\" name=\"headerframe\" id=\"headerframe\" title=\"");]]></jsp:scriptlet>
      <c:out value="${wizard_header_frame_title}"/>
      <jsp:scriptlet><![CDATA[out.print("\" scrolling=\"no\"/>");]]></jsp:scriptlet>
      <frameset id="navset" cols="180,*">
        <jsp:scriptlet><![CDATA[out.print("<frame src=\"");]]></jsp:scriptlet>
        <c:out value="${navUrl}"/>
        <jsp:scriptlet><![CDATA[out.print("\" name=\"navframe\" id=\"navframe\" title=\"");]]></jsp:scriptlet>
        <c:out value="${wizard_navigation_frame_title}"/>
        <jsp:scriptlet><![CDATA[out.print("\" />");]]></jsp:scriptlet>
        <frame name="targetframe" id="targetframe" src="loading.jspx?o3ctx=${currentContext}" title="${wizard_content_frame_title}" />
      </frameset>
      <jsp:scriptlet><![CDATA[out.print("<frame src=\"");]]></jsp:scriptlet>
      <c:out value="${buttonsUrl}"/>
      <jsp:scriptlet><![CDATA[out.print("\" name=\"buttonframe\" style=\"height:35px;\" title=\"");]]></jsp:scriptlet>
      <c:out value="${wizard_button_frame_title}"/>
      <jsp:scriptlet><![CDATA[out.print("\" />");]]></jsp:scriptlet>
    <jsp:scriptlet><![CDATA[out.print("</frameset>");]]></jsp:scriptlet>
    </c:if>
  <jsp:scriptlet><![CDATA[out.print("</html>");]]></jsp:scriptlet>
</jsp:root>
